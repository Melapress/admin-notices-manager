"use strict";!function(l){({container:null,counter_link:null,migration_delay:100,migration_interval:null,migration_start:0,migration_limit:5e3,popup_delay:50,popup_interval:null,popup_start:0,popup_limit:1e3,removal_interval:null,system_messages:[],init:function(){var n=this,t=this,e='<div id="anm-system-notices"></div><div id="anm-error-notices"></div><div id="anm-warning-notices"></div><div id="anm-success-notices"></div><div id="anm-information-notices"></div>';"popup"==anm_i18n.settings.popup_style?(l("body").append('<div id="anm-container" style="display: none;">'+e+"</div>"),this.container=l("#anm-container")):(l("body").append('<div id="anm-container-slide-in" style="background-color: '+anm_i18n.settings.slide_in_background_colour+';"><div id="anm-slide-in-content">'+e+"</div></div>"),this.container=l("#anm-slide-in-content")),this.counter_link=l("#wp-admin-bar-anm_notification_count"),this.initTriggers(),this.migration_start=(new Date).getTime(),this.migration_interval=setInterval(function(){n.transferNotices()},this.migration_delay);for(var i=0,a=setInterval(function(){3===(i+=1)&&t.CheckAndStoreNotices(),4===i&&clearInterval(a)},150),o=anm_i18n.system_messages.length,s=0;s<o;s++){var r=anm_i18n.system_messages[s];this.system_messages.push(r.replace(/%[sdf]/g,""))}},getCurrentCounterValue:function(){var n=l(".anm-notification-counter span.count");return 0==n.length?0:parseInt(n.html(),10)},getNoticeType:function(n){var t=l(n);return t.hasClass("notice-system")?"system":t.hasClass("notice-error")?"error":t.hasClass("notice-info")||t.hasClass("notice-information")?"information":t.hasClass("notice-warning")?"warning":t.hasClass("notice-success")||t.hasClass("updated")?"success":"no"},checkMigrationInterval:function(){(new Date).getTime()-this.migration_start>this.migration_limit&&(clearInterval(this.migration_interval),this.migration_interval=null,this.CheckAndStoreNotices())},transferNotices:function(){var s=this,n=l("#wpbody-content .wrap").find("div.updated, div.error, div.notice, #message").not('.hidden, .hide-if-js, .update-message, [aria-hidden="true"]');n.each(function(n,t){for(var e=s.system_messages.length,i=0;i<e;i++){var a=s.system_messages[i];0<t.innerHTML.indexOf(a)&&l(t).addClass("notice-system")}});var r=0,c=this.container;n.each(function(n,t){var e,i=s.getNoticeType(t),a="system"===i?"wordpress_system_admin_notices":i+"_level_notices",o=anm_i18n.settings[a];"hide"===o?l(t).remove():"popup-only"===o&&(e=l(c).find("#anm-"+i+"-notices"),l(t).detach().appendTo(e),r++)});var t=r;0<l(".anm-notification-counter").length&&(t+=this.getCurrentCounterValue()),this.updateCounterBubble(t),this.checkMigrationInterval()},updateCounterBubble:function(n){var t,e;0!==n&&(0<l(".anm-notification-counter").length?l(".anm-notification-counter span.count").html(n):(t=anm_i18n.title,this.counter_link.find("a").html(t),e='<div class="anm-notification-counter wp-core-ui wp-ui-notification"><span aria-hidden="true" class="count">'+n+'</span><span class="screen-reader-text">'+n+" "+t+"</span></div>",this.counter_link.attr("data-popup-title",t),this.counter_link.find("a").append(e),this.counter_link.addClass("has-data")))},adjustModalHeight:function(){l("#TB_ajaxContent").css({width:"100%",height:l("#TB_window").height()-l("#TB_title").outerHeight()-22+"px",padding:"2px 0px 20px 0px"}),this.popup_interval&&(new Date).getTime()-this.popup_start>this.popup_limit&&(clearInterval(this.popup_interval),this.popup_interval=null)},checkNoticeRemoval:function(){var n;l("#TB_ajaxContent").height()?(n=l("#TB_ajaxContent").find(".notice").not(":hidden").length,this.getCurrentCounterValue()!==n&&this.updateCounterBubble(n)):this.removal_interval&&clearInterval(this.removal_interval)},CheckAndStoreNotices:function(){var t=jQuery(this.container).find(".notice"),i=[],e=this;t.each(function(n,t){jQuery(t).find(".anm-notice-timestap").remove();var e=t.outerHTML;i[n]=e}),jQuery.ajax({type:"POST",dataType:"json",url:anm_i18n.ajaxurl,data:{action:"anm_log_notices",_wpnonce:anm_i18n.nonce,notices:i},complete:function(n){e.appendTimeDate(t,n.responseJSON.data),l(".anm-notification-counter").addClass("display")}})},appendTimeDate:function(n,a){var o=this;n.each(function(n,t){var e,i;"do-not-display"==a[n]?(jQuery(t).remove(),e=o.getCurrentCounterValue()-1,o.updateCounterBubble(e)):(i='<div class="anm-notice-timestap"><span class="anm-time">'+anm_i18n.date_time_preamble+a[n][1]+'</span><a href="#" data-hide-notice-forever="'+a[n][0]+'">Hide notice forever</a></div>',jQuery(t).find(".anm-notice-timestap").length||jQuery(i).appendTo(t))})},initTriggers:function(){var o=this;this.counter_link.click(function(){return o.popup_interval&&(clearInterval(o.popup_interval),o.popup_interval=null),0==o.getCurrentCounterValue()||("popup"==anm_i18n.settings.popup_style?tb_show(o.counter_link.attr("data-popup-title"),"#TB_inline?inlineId=anm-container"):l("#anm-container-slide-in").addClass("show"),o.popup_start=(new Date).getTime(),o.popup_interval=setInterval(function(){o.adjustModalHeight.call(o)},o.popup_delay),o.removal_interval&&clearInterval(o.removal_interval),o.removal_interval=setInterval(function(){o.checkNoticeRemoval.call(o)},o.popup_delay)),!1}),l(window).resize(function(){"popup"==anm_i18n.settings.popup_style&&o.adjustModalHeight.call(o)}),"slide-in"==anm_i18n.settings.popup_style&&l(document).on("click","body *",function(n){l(n.target).is("#anm-container-slide-in a")||l(n.target).is("#anm-container-slide-in")||l("#anm-container-slide-in").removeClass("show")}),jQuery(document).on("click","[data-hide-notice-forever]",function(n){n.preventDefault();var t=jQuery(this).attr("data-hide-notice-forever"),e=jQuery(this).closest(".notice"),i=l(".anm-notification-counter span.count").text(),a=o;jQuery.ajax({type:"POST",dataType:"json",url:anm_i18n.ajaxurl,data:{action:"anm_hide_notice_forever",_wpnonce:anm_i18n.nonce,notice_hash:t},complete:function(){e.slideUp();var n=i-1;a.updateCounterBubble(n)}})})}}).init()}(jQuery);