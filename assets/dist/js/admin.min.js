"use strict";!function(c,e){({container:null,counter_link:null,migration_delay:100,migration_interval:null,migration_start:0,migration_limit:5e3,popup_delay:50,popup_interval:null,popup_start:0,popup_limit:1e3,removal_interval:null,system_messages:[],init:function(){for(var t=this,e=this,n='<div id="anm-system-notices"></div><div id="anm-error-notices"></div><div id="anm-warning-notices"></div><div id="anm-success-notices"></div><div id="anm-information-notices"></div>',i=("popup"==anm_i18n.settings.popup_style?(c("body").append('<div id="anm-container" style="display: none;">'+n+"</div>"),this.container=c("#anm-container")):(c("body").append('<div id="anm-container-slide-in" style="background-color: '+anm_i18n.settings.slide_in_background_colour+';"><div id="anm-slide-in-content">'+n+"</div></div>"),this.container=c("#anm-slide-in-content")),this.counter_link=c("#wp-admin-bar-anm_notification_count"),this.initTriggers(),this.migration_start=(new Date).getTime(),this.migration_interval=setInterval(function(){t.transferNotices()},this.migration_delay),0),a=setInterval(function(){3===(i+=1)&&e.CheckAndStoreNotices(),4===i&&clearInterval(a)},150),o=anm_i18n.system_messages.length,s=0;s<o;s++){var r=anm_i18n.system_messages[s];this.system_messages.push(r.replace(/%[sdf]/g,""))}},getCurrentCounterValue:function(){var t=c(".anm-notification-counter span.count");return 0==t.length?0:parseInt(t.html(),10)},getNoticeType:function(t){t=c(t);return t.hasClass("notice-system")?"system":t.hasClass("notice-error")?"error":t.hasClass("notice-info")||t.hasClass("notice-information")?"information":t.hasClass("notice-warning")?"warning":t.hasClass("notice-success")||t.hasClass("updated")?"success":"no"},checkMigrationInterval:function(){var t;(new Date).getTime()-this.migration_start>this.migration_limit&&(clearInterval(this.migration_interval),this.migration_interval=null,this.CheckAndStoreNotices(),0<(t=c(".anm-notices-wrapper")).children(this.getIgnoreSelector()).length&&(t.children().not(this.getIgnoreSelector()).remove(),t.show()))},getIgnoreSelector:function(){var t='.hidden, .hide-if-js, .update-message, [aria-hidden="true"]';return 0<anm_i18n.settings.css_selector.length&&(t+=", "+anm_i18n.settings.css_selector),t},transferNotices:function(){var o=this,t=c("#wpbody-content .wrap").find("div.updated, div.error, div.notice, #message").not(this.getIgnoreSelector()),a=(t.each(function(t,e){for(var n=o.system_messages.length,i=0;i<n;i++){var a=o.system_messages[i];0<e.innerHTML.indexOf(a)&&c(e).addClass("notice-system")}}),0),s=this.container,t=(t.each(function(t,e){var n=o.getNoticeType(e),i=anm_i18n.settings["system"===n?"wordpress_system_admin_notices":n+"_level_notices"];"hide"===i?c(e).remove():"popup-only"===i&&(i=c(s).find("#anm-"+n+"-notices"),c(e).detach().appendTo(i),a++)}),a);0<c(".anm-notification-counter").length&&(t+=this.getCurrentCounterValue()),this.updateCounterBubble(t),this.checkMigrationInterval()},updateCounterBubble:function(t){var e;0!==t&&(0<c(".anm-notification-counter").length?c(".anm-notification-counter span.count").html(t):(e=anm_i18n.title,this.counter_link.find("a").html(e),t='<div class="anm-notification-counter wp-core-ui wp-ui-notification"><span aria-hidden="true" class="count">'+t+'</span><span class="screen-reader-text">'+t+" "+e+"</span></div>",this.counter_link.attr("data-popup-title",e),this.counter_link.find("a").append(t),this.counter_link.addClass("has-data")))},adjustModalHeight:function(){c("#TB_ajaxContent").css({width:"100%",height:c("#TB_window").height()-c("#TB_title").outerHeight()-22+"px",padding:"2px 0px 20px 0px"}),this.popup_interval&&(new Date).getTime()-this.popup_start>this.popup_limit&&(clearInterval(this.popup_interval),this.popup_interval=null)},checkNoticeRemoval:function(){var t;c("#TB_ajaxContent").height()?(t=c("#TB_ajaxContent").find(".notice").not(":hidden").length,this.getCurrentCounterValue()!==t&&this.updateCounterBubble(t)):this.removal_interval&&clearInterval(this.removal_interval)},CheckAndStoreNotices:function(){var e=jQuery(this.container).find(".notice"),n=[],i=this;e.each(function(t,e){jQuery(e).find(".anm-notice-timestap").remove();e=e.outerHTML;n[t]=e}),jQuery.ajax({type:"POST",dataType:"json",url:anm_i18n.ajaxurl,data:{action:"anm_log_notices",_wpnonce:anm_i18n.nonce,notices:n},complete:function(t){i.appendTimeDate(e,t.responseJSON.data),c(".anm-notification-counter").addClass("display")}})},appendTimeDate:function(t,i){var a=this;t.each(function(t,e){var n;"do-not-display"==i[t]?(jQuery(e).remove(),n=a.getCurrentCounterValue(),a.updateCounterBubble(n-1)):(n='<div class="anm-notice-timestap"><span class="anm-time">'+anm_i18n.date_time_preamble+i[t][1]+'</span><a href="#" data-hide-notice-forever="'+i[t][0]+'">Hide notice forever</a></div>',jQuery(e).find(".anm-notice-timestap").length||jQuery(n).appendTo(e))})},initTriggers:function(){var a=this;this.counter_link.click(function(){return a.popup_interval&&(clearInterval(a.popup_interval),a.popup_interval=null),0==a.getCurrentCounterValue()||("popup"==anm_i18n.settings.popup_style?tb_show(a.counter_link.attr("data-popup-title"),"#TB_inline?inlineId=anm-container"):c("#anm-container-slide-in").addClass("show"),a.popup_start=(new Date).getTime(),a.popup_interval=setInterval(function(){a.adjustModalHeight.call(a)},a.popup_delay),a.removal_interval&&clearInterval(a.removal_interval),a.removal_interval=setInterval(function(){a.checkNoticeRemoval.call(a)},a.popup_delay)),!1}),c(e).resize(function(){"popup"==anm_i18n.settings.popup_style&&a.adjustModalHeight.call(a)}),"slide-in"==anm_i18n.settings.popup_style&&c(document).on("click","body *",function(t){c(t.target).is("#anm-container-slide-in a")||c(t.target).is("#anm-container-slide-in")||c("#anm-container-slide-in").removeClass("show")}),jQuery(document).on("click","[data-hide-notice-forever]",function(t){t.preventDefault();var t=jQuery(this).attr("data-hide-notice-forever"),e=jQuery(this).closest(".notice"),n=c(".anm-notification-counter span.count").text(),i=a;jQuery.ajax({type:"POST",dataType:"json",url:anm_i18n.ajaxurl,data:{action:"anm_hide_notice_forever",_wpnonce:anm_i18n.nonce,notice_hash:t},complete:function(t){e.slideUp(),i.updateCounterBubble(n-1)}})})}}).init(),e.anm_settings=e.anm_settings||{select_appropriate_radio:function(t){(0===c(t.target).val().length?c(t.target).closest("fieldset").find('input[type="radio"]').first():c(t.target).prevAll("label").first().find('input[type="radio"]')).prop("checked",!0)},append_select2_events:function(t){t.on("select2:select",e.anm_settings.select_appropriate_radio).on("select2:unselect",e.anm_settings.select_appropriate_radio).on("change",e.anm_settings.select_appropriate_radio)}}}(jQuery,window);